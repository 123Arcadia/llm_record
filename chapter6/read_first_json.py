import json
from json.decoder import JSONDecodeError

def read_first_n_json_lines(file_path, n=5):
    """
    读取JSON Lines格式文件的前n个数据
    JSON Lines格式：每行一个独立的JSON对象
    """
    data = []
    with open(file_path, 'r', encoding='utf-8') as f:
        count = 0
        for line in f:
            if count >= n:
                break
            line = line.strip()
            if not line:
                continue
            try:
                json_obj = json.loads(line)
                data.append(json_obj)
                count += 1
            except JSONDecodeError:
                print(f"跳过无效的JSON行: {line}")
    return data

def read_first_n_from_json_array(file_path, n=5):
    """
    读取JSON数组文件中的前n个元素
    适用于整个文件是一个大JSON数组的情况
    """
    data = []
    # 使用json.JSONDecoder进行流式解析
    decoder = json.JSONDecoder()
    with open(file_path, 'r', encoding='utf-8') as f:
        buffer = ''
        count = 0
        while True:
            # 读取一部分数据
            chunk = f.read(4096)  # 每次读取4KB
            if not chunk and not buffer:
                break  # 文件结束
            buffer += chunk

            # 尝试解析缓冲区中的JSON
            try:
                # 查找数组的开始
                if buffer.startswith('['):
                    buffer = buffer[1:].lstrip()  # 跳过数组开始符和空格

                while count < n and buffer:
                    # 解析一个JSON对象
                    obj, index = decoder.raw_decode(buffer)
                    data.append(obj)
                    count += 1
                    # 更新缓冲区，去掉已解析的部分
                    buffer = buffer[index:].lstrip()

                    # 如果遇到数组结束符，提前退出
                    if buffer.startswith(']'):
                        break
            except JSONDecodeError:
                # 缓冲区数据不足，继续读取
                continue

            # 如果已经获取了足够的数据，退出
            if count >= n:
                break
    return data

# 使用示例
if __name__ == "__main__":
    # 处理JSON Lines格式文件（每行一个JSON对象）
    # path  ='./autodl-tmp/dataset/sft_data/BelleGroup/train_3.5M_CN.json'
    path  ='./autodl-tmp/dataset/pretrain_data/mobvoi_seq_monkey_general_open_corpus.jsonl'
    jsonl_data = read_first_n_json_lines(path, 5)
    print(f"从JSON Lines文件读取了{len(jsonl_data)}个数据")
    print(f'{jsonl_data=}')
    print('-'*50)
    # 处理JSON数组格式文件（整个文件是一个大数组）
    json_array_data = read_first_n_from_json_array(path, 5)
    print(f"从JSON数组文件读取了{len(json_array_data)}个数据")
    print(f'{json_array_data=}')


#     从JSON Lines文件读取了5个数据
# jsonl_data=[{'conversations': [{'from': 'human', 'value': '针对健身房的新手，设计一套适合他们的健身器械使用指南，包括安全应用、正确姿势等方面。'}, {'from': 'assistant', 'value': '健身器械使用指南\n1. 开始前，请先进行热身运动。这会帮助你的身体适应运动，并减少受伤的风险。\n2. 在使用健身器械前，确保你已经了解了其使用方法。请阅读说明书或咨询教练以获得正确的使用技巧。\n3. 谨防过度使用或过度挑战你的身体。 如果你觉得有些动作太难或太重，请添加锻炼计划，以逐步提高动作难度。\n4. 使用合适的装备。 确保你拥有合适的运动鞋和舒适的运动服。 不要在裸露的脚或短裤上进行重量训练。\n5. 在健身器械上使用安全装置。 这些通常用于保护你的身体免受不当操作造成的损伤。 例如，重量训练中，你需要使用杠铃和负重时，一定要使用卡子来防止重量滑落。\n6. 注意正确的姿势。 如果你的姿势是错误的，那么你的身体很容易被伤害到，你也可能无法获得最佳的锻炼效果。 至关重要的是，保持直立的身体，保持头部和颈部的稳定，并使用合适的重量。\n7. 保持合理的呼吸方式。 无论何时进行训练，都必须保持正常呼吸。 当你需要用力时，呼气； 当你放松时，吸气。\n8. 安全存放器械。 在使用健身器械后，你需要把它们归还给适当的位置，以便其他人可以使用它们。\n总之，健身器械的正确使用是关键之一，如果不健康和不安全，它们将无法帮助您达到您所需的健康成果。 选择适当的训练计划，并为训练提供足够的时间，以备逐渐适应新方法。 对于任何问题，请向教练咨询。'}], 'id': '66182880'}, {'conversations': [{'from': 'human', 'value': '给定一段文本和关键词列表，删除文本中包含所有给定关键词的子字符串。\n文本："这是一个测试句子，目的是看看模型是否可以正确地从这个句子中删除关键词。"\\n关键词列表：[‘测试’，‘模型’]'}, {'from': 'assistant', 'value': '删除包含所有给定关键词的子字符串后，文本变为："这是一个句子，目的是看看是否可以正确地从这个句子中删除关键词。"'}, {'from': 'human', 'value': '好的。现在请你将这个文本中的所有的逗号都替换成空格。'}, {'from': 'assistant', 'value': '好的，请稍等一下，现在我会将文本中的所有逗号替换为空格。处理后文本为："这是一个句子 目的是看看是否可以正确地从这个句子中删除关键词。"。处理结果如何？'}], 'id': '16012449'}, {'conversations': [{'from': 'human', 'value': '写一个关于秋天的诗吧。'}, {'from': 'assistant', 'value': '红黄绿交织，田野金黄色。风吹枫叶落，人在秋天慢步行。'}, {'from': 'human', 'value': '给我推荐一些好听的摇滚歌曲。'}, {'from': 'assistant', 'value': "摇滚歌曲推荐：AC/DC的Back in Black，Guns N' Roses的Sweet Child O' Mine，Rolling Stones的Satisfaction，Led Zeppelin的Stairway to Heaven，Nirvana的Smells Like Teen Spirit等。"}, {'from': 'human', 'value': '计算一下2的100次方。'}, {'from': 'assistant', 'value': '2的100次方等于1.267650600228229401496703205376e+30，约等于1.27乘以10的30次方。'}, {'from': 'human', 'value': '帮我回答一道历史题目。清朝时期的八旗共有多少旗人？'}, {'from': 'assistant', 'value': '清朝时期八旗旗人总数约为200万人左右，其中正黄旗、正蓝旗、正白旗、正红旗的人数较多，其他旗的人数较少。'}], 'id': '77390706'}, {'conversations': [{'from': 'human', 'value': '介绍一道好吃的家常菜的做法'}, {'from': 'assistant', 'value': '番茄炒蛋\n材料：\n鸡蛋3个、番茄1个、油、盐、糖、水淀粉\n做法：\n1.番茄洗净切成小块；鸡蛋打入碗中搅匀备用。\n2.热锅凉油，油热后放入番茄翻炒。\n3.番茄煮软后放盐，糖调味，再倒入打好的鸡蛋液，翻炒均匀。\n4.鸡蛋凝固后关火。\n5.加入半碗水，大火煮开。\n6.用水淀粉勾芡，装盘即可。\n小贴士：\n1. 番茄不能切得太细，否则炒出来就不太好看了。\n2. 在调味时，糖的分量也很重要，可以根据自己的口味来调节。\n3. 水淀粉勾芡的比例是：水和淀粉的比例大概是5:1。\n4. 煮开之后，记得要把水淀粉慢慢倒入，同时不断地搅拌，以免结块。\n5. 最后装盘时可以点缀一些绿色蔬菜，既好看又好吃。'}, {'from': 'human', 'value': '嗯，谢谢你介绍的做法很详细，但我不喜欢吃鸡蛋，有没有其他菜做法能介绍一下？'}, {'from': 'assistant', 'value': '当然，你可以试试酸辣土豆丝这道菜。\n材料：\n土豆2个、红椒1个、青椒1个、大葱1根、醋、生抽、盐、鸡精、料酒\n做法：\n1.土豆去皮，切成丝；红椒和青椒切成细丝；大葱切段备用。\n2.热锅凉油，油热后放入土豆丝，煸炒至变软。\n3.倒入红椒、青椒和大葱段，继续煸炒至熟。\n4.加入适量的盐、鸡精、料酒和生抽，翻炒均匀。\n5.最后，加入适量的醋，翻炒均匀即可。\n小贴士：\n1. 土豆切丝时，可以放入淡盐水中泡一下，这样可以去除多余的淀粉。\n2. 煮土豆丝时，不要煮得太久，以免烂糊。\n3. 加入醋的时候，根据自己的口味多少来进行调节，一般来说，盐与醋的比例为1:1。\n4. 如果喜欢辣味可以加入一些干辣椒丝。\n希望你会喜欢这道酸辣土豆丝！'}], 'id': '78716244'}, {'conversations': [{'from': 'human', 'value': '请描述一下如何正确规划个人理财。'}, {'from': 'assistant', 'value': '正确规划个人理财需要以下几个步骤：\n1.了解自己的财务状况。这包括收入、支出、资产和负债等信息。了解自己的财务状况可以帮助人们更好地制定财务计划。\n2.设定财务目标。需要考虑短期目标和长期目标，例如以年为单位设定的支出计划、购房、购车等的长期目标。\n3.制定预算计划。在了解自己的财务状况并设定财务目标后，需要制定一个预算计划。这可以帮助人们控制支出、节省开支并达到财务目标。\n4.理性投资和储蓄。人们可以投资于股票、基金、房产或其他投资渠道以实现财务目标。但在投资前需了解相关知识并进行风险评估。同时还应储蓄一定金额，以应对突发事件或为达成某些目标做准备。\n5.审时度势，合理调整。财务计划需要不断地审时度势，根据实际情况做出调整，以达到最终的财务目标。需要注意财务状况的变化、投资的收益和风险等因素。\n通过以上五个步骤，人们可以做到合理规划个人理财，掌握自己的财务命运，更好地实现自己的财务目标。'}], 'id': '60701919'}]
# --------------------------------------------------
# 从JSON数组文件读取了5个数据
# json_array_data=[{'conversations': [{'from': 'human', 'value': '针对健身房的新手，设计一套适合他们的健身器械使用指南，包括安全应用、正确姿势等方面。'}, {'from': 'assistant', 'value': '健身器械使用指南\n1. 开始前，请先进行热身运动。这会帮助你的身体适应运动，并减少受伤的风险。\n2. 在使用健身器械前，确保你已经了解了其使用方法。请阅读说明书或咨询教练以获得正确的使用技巧。\n3. 谨防过度使用或过度挑战你的身体。 如果你觉得有些动作太难或太重，请添加锻炼计划，以逐步提高动作难度。\n4. 使用合适的装备。 确保你拥有合适的运动鞋和舒适的运动服。 不要在裸露的脚或短裤上进行重量训练。\n5. 在健身器械上使用安全装置。 这些通常用于保护你的身体免受不当操作造成的损伤。 例如，重量训练中，你需要使用杠铃和负重时，一定要使用卡子来防止重量滑落。\n6. 注意正确的姿势。 如果你的姿势是错误的，那么你的身体很容易被伤害到，你也可能无法获得最佳的锻炼效果。 至关重要的是，保持直立的身体，保持头部和颈部的稳定，并使用合适的重量。\n7. 保持合理的呼吸方式。 无论何时进行训练，都必须保持正常呼吸。 当你需要用力时，呼气； 当你放松时，吸气。\n8. 安全存放器械。 在使用健身器械后，你需要把它们归还给适当的位置，以便其他人可以使用它们。\n总之，健身器械的正确使用是关键之一，如果不健康和不安全，它们将无法帮助您达到您所需的健康成果。 选择适当的训练计划，并为训练提供足够的时间，以备逐渐适应新方法。 对于任何问题，请向教练咨询。'}], 'id': '66182880'}, {'conversations': [{'from': 'human', 'value': '给定一段文本和关键词列表，删除文本中包含所有给定关键词的子字符串。\n文本："这是一个测试句子，目的是看看模型是否可以正确地从这个句子中删除关键词。"\\n关键词列表：[‘测试’，‘模型’]'}, {'from': 'assistant', 'value': '删除包含所有给定关键词的子字符串后，文本变为："这是一个句子，目的是看看是否可以正确地从这个句子中删除关键词。"'}, {'from': 'human', 'value': '好的。现在请你将这个文本中的所有的逗号都替换成空格。'}, {'from': 'assistant', 'value': '好的，请稍等一下，现在我会将文本中的所有逗号替换为空格。处理后文本为："这是一个句子 目的是看看是否可以正确地从这个句子中删除关键词。"。处理结果如何？'}], 'id': '16012449'}, {'conversations': [{'from': 'human', 'value': '写一个关于秋天的诗吧。'}, {'from': 'assistant', 'value': '红黄绿交织，田野金黄色。风吹枫叶落，人在秋天慢步行。'}, {'from': 'human', 'value': '给我推荐一些好听的摇滚歌曲。'}, {'from': 'assistant', 'value': "摇滚歌曲推荐：AC/DC的Back in Black，Guns N' Roses的Sweet Child O' Mine，Rolling Stones的Satisfaction，Led Zeppelin的Stairway to Heaven，Nirvana的Smells Like Teen Spirit等。"}, {'from': 'human', 'value': '计算一下2的100次方。'}, {'from': 'assistant', 'value': '2的100次方等于1.267650600228229401496703205376e+30，约等于1.27乘以10的30次方。'}, {'from': 'human', 'value': '帮我回答一道历史题目。清朝时期的八旗共有多少旗人？'}, {'from': 'assistant', 'value': '清朝时期八旗旗人总数约为200万人左右，其中正黄旗、正蓝旗、正白旗、正红旗的人数较多，其他旗的人数较少。'}], 'id': '77390706'}, {'conversations': [{'from': 'human', 'value': '介绍一道好吃的家常菜的做法'}, {'from': 'assistant', 'value': '番茄炒蛋\n材料：\n鸡蛋3个、番茄1个、油、盐、糖、水淀粉\n做法：\n1.番茄洗净切成小块；鸡蛋打入碗中搅匀备用。\n2.热锅凉油，油热后放入番茄翻炒。\n3.番茄煮软后放盐，糖调味，再倒入打好的鸡蛋液，翻炒均匀。\n4.鸡蛋凝固后关火。\n5.加入半碗水，大火煮开。\n6.用水淀粉勾芡，装盘即可。\n小贴士：\n1. 番茄不能切得太细，否则炒出来就不太好看了。\n2. 在调味时，糖的分量也很重要，可以根据自己的口味来调节。\n3. 水淀粉勾芡的比例是：水和淀粉的比例大概是5:1。\n4. 煮开之后，记得要把水淀粉慢慢倒入，同时不断地搅拌，以免结块。\n5. 最后装盘时可以点缀一些绿色蔬菜，既好看又好吃。'}, {'from': 'human', 'value': '嗯，谢谢你介绍的做法很详细，但我不喜欢吃鸡蛋，有没有其他菜做法能介绍一下？'}, {'from': 'assistant', 'value': '当然，你可以试试酸辣土豆丝这道菜。\n材料：\n土豆2个、红椒1个、青椒1个、大葱1根、醋、生抽、盐、鸡精、料酒\n做法：\n1.土豆去皮，切成丝；红椒和青椒切成细丝；大葱切段备用。\n2.热锅凉油，油热后放入土豆丝，煸炒至变软。\n3.倒入红椒、青椒和大葱段，继续煸炒至熟。\n4.加入适量的盐、鸡精、料酒和生抽，翻炒均匀。\n5.最后，加入适量的醋，翻炒均匀即可。\n小贴士：\n1. 土豆切丝时，可以放入淡盐水中泡一下，这样可以去除多余的淀粉。\n2. 煮土豆丝时，不要煮得太久，以免烂糊。\n3. 加入醋的时候，根据自己的口味多少来进行调节，一般来说，盐与醋的比例为1:1。\n4. 如果喜欢辣味可以加入一些干辣椒丝。\n希望你会喜欢这道酸辣土豆丝！'}], 'id': '78716244'}, {'conversations': [{'from': 'human', 'value': '请描述一下如何正确规划个人理财。'}, {'from': 'assistant', 'value': '正确规划个人理财需要以下几个步骤：\n1.了解自己的财务状况。这包括收入、支出、资产和负债等信息。了解自己的财务状况可以帮助人们更好地制定财务计划。\n2.设定财务目标。需要考虑短期目标和长期目标，例如以年为单位设定的支出计划、购房、购车等的长期目标。\n3.制定预算计划。在了解自己的财务状况并设定财务目标后，需要制定一个预算计划。这可以帮助人们控制支出、节省开支并达到财务目标。\n4.理性投资和储蓄。人们可以投资于股票、基金、房产或其他投资渠道以实现财务目标。但在投资前需了解相关知识并进行风险评估。同时还应储蓄一定金额，以应对突发事件或为达成某些目标做准备。\n5.审时度势，合理调整。财务计划需要不断地审时度势，根据实际情况做出调整，以达到最终的财务目标。需要注意财务状况的变化、投资的收益和风险等因素。\n通过以上五个步骤，人们可以做到合理规划个人理财，掌握自己的财务命运，更好地实现自己的财务目标。'}], 'id': '60701919'}]
